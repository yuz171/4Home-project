{"version":3,"sources":["components/NavHeader/index.js","components/NavHeader/index.module.css","pages/Login/index.module.css","pages/Login/index.js"],"names":["withRouter","_ref","children","history","onLeftClick","className","rightContent","react__WEBPACK_IMPORTED_MODULE_2___default","a","createElement","antd_mobile_lib_nav_bar__WEBPACK_IMPORTED_MODULE_1___default","styles","navBar","join","mode","icon","go","module","exports","root","navHeader","backHome","formItem","input","formSubmit","submit","error","Login","react__WEBPACK_IMPORTED_MODULE_15___default","_components_NavHeader__WEBPACK_IMPORTED_MODULE_20__","antd_mobile_lib_white_space__WEBPACK_IMPORTED_MODULE_9___default","size","antd_mobile_lib_wing_blank__WEBPACK_IMPORTED_MODULE_5___default","formik__WEBPACK_IMPORTED_MODULE_17__","name","placeholder","component","type","antd_mobile_lib_flex__WEBPACK_IMPORTED_MODULE_7___default","Item","react_router_dom__WEBPACK_IMPORTED_MODULE_16__","to","Component","withFormik","mapPropsToValues","username","password","validationSchema","Yup","shape","required","matches","handleSubmit","_handleSubmit","Object","E_react_project_hkzf_mobile_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__","E_react_project_hkzf_mobile_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","mark","_callee","values","props","res","_res$data","status","body","description","wrap","_context","prev","next","API","post","sent","data","localStorage","setItem","token","location","state","replace","from","pathname","antd_mobile_lib_toast__WEBPACK_IMPORTED_MODULE_2___default","info","stop","_x","_x2","apply","this","arguments"],"mappings":"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","file":"static/js/19.d2e05d88.chunk.js","sourcesContent":["import React from 'react'\r\n\r\nimport { NavBar } from 'antd-mobile'\r\n\r\n// 导入 withRouter 高阶组件\r\nimport { withRouter } from 'react-router-dom'\r\n\r\n// 导入 props 校验的包\r\nimport PropTypes from 'prop-types'\r\n\r\n// 导入样式\r\n// import './index.scss'\r\nimport styles from './index.module.css'\r\n\r\n// 添加 className 和 rightContent（导航栏右侧内容） 属性\r\nfunction NavHeader({\r\n  children,\r\n  history,\r\n  onLeftClick,\r\n  className,\r\n  rightContent\r\n}) {\r\n  // 默认点击行为\r\n  const defaultHandler = () => history.go(-1)\r\n\r\n  return (\r\n    <NavBar\r\n      className={[styles.navBar, className || ''].join(' ')}\r\n      mode=\"light\"\r\n      icon={<i className=\"iconfont icon-back\" />}\r\n      onLeftClick={onLeftClick || defaultHandler}\r\n      rightContent={rightContent}\r\n    >\r\n      {children}\r\n    </NavBar>\r\n  )\r\n}\r\n\r\n// 添加props校验\r\nNavHeader.propTypes = {\r\n  children: PropTypes.string.isRequired,\r\n  onLeftClick: PropTypes.func,\r\n  className: PropTypes.string,\r\n  rightContent: PropTypes.array\r\n}\r\n\r\n// withRouter(NavHeader) 函数的返回值也是一个组件\r\nexport default withRouter(NavHeader)\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"navBar\":\"NavHeader_navBar__3a5BZ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"Login_root__1AMB0\",\"navHeader\":\"Login_navHeader__1D_lV\",\"backHome\":\"Login_backHome__10ref\",\"formItem\":\"Login_formItem__Mf5HJ\",\"input\":\"Login_input__3h38e\",\"formSubmit\":\"Login_formSubmit__25HhB\",\"submit\":\"Login_submit__2PkzZ\",\"error\":\"Login_error__5Xdzk\"};","import React, { Component } from 'react'\r\nimport { Flex, WingBlank, WhiteSpace, Toast } from 'antd-mobile'\r\n\r\nimport { Link } from 'react-router-dom'\r\n\r\n// 导入withFormik\r\nimport { withFormik, Form, Field, ErrorMessage } from 'formik'\r\n\r\n// 导入Yup\r\nimport * as Yup from 'yup'\r\n\r\n// 导入 API\r\nimport { API } from '../../utils'\r\n\r\nimport NavHeader from '../../components/NavHeader'\r\n\r\nimport styles from './index.module.css'\r\n\r\n// 验证规则：\r\nconst REG_UNAME = /^[a-zA-Z_\\d]{5,8}$/\r\nconst REG_PWD = /^[a-zA-Z_\\d]{5,12}$/\r\n\r\n/* \r\n  简化表单处理：\r\n\r\n  1 导入 Form 组件，替换 form 元素，去掉 onSubmit。\r\n  2 导入 Field 组件，替换 input 表单元素，去掉 onChange、onBlur、value。\r\n  3 导入 ErrorMessage 组件，原来的错误消息逻辑代码。\r\n  4 去掉所有 props。\r\n*/\r\n\r\nclass Login extends Component {\r\n  render() {\r\n    return (\r\n      <div className={styles.root}>\r\n        {/* 顶部导航 */}\r\n        <NavHeader className={styles.navHeader}>账号登录</NavHeader>\r\n        <WhiteSpace size=\"xl\" />\r\n\r\n        {/* 登录表单 */}\r\n        <WingBlank>\r\n          <Form>\r\n            {/* 账号 */}\r\n            <div className={styles.formItem}>\r\n              <Field\r\n                className={styles.input}\r\n                name=\"username\"\r\n                placeholder=\"请输入账号\"\r\n              />\r\n            </div>\r\n            <ErrorMessage\r\n              className={styles.error}\r\n              name=\"username\"\r\n              component=\"div\"\r\n            />\r\n            {/* 密码 */}\r\n            <div className={styles.formItem}>\r\n              <Field\r\n                className={styles.input}\r\n                name=\"password\"\r\n                type=\"password\"\r\n                placeholder=\"请输入密码\"\r\n              />\r\n            </div>\r\n            <ErrorMessage\r\n              className={styles.error}\r\n              name=\"password\"\r\n              component=\"div\"\r\n            />\r\n            <div className={styles.formSubmit}>\r\n              <button className={styles.submit} type=\"submit\">\r\n                登 录\r\n              </button>\r\n            </div>\r\n          </Form>\r\n          <Flex className={styles.backHome}>\r\n            <Flex.Item>\r\n              <Link to=\"/registe\">还没有账号，去注册~</Link>\r\n            </Flex.Item>\r\n          </Flex>\r\n        </WingBlank>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n// 使用 withFormik 高阶组件包装 Login 组件，为 Login 组件提供属性和方法\r\nLogin = withFormik({\r\n  // 提供状态：\r\n  mapPropsToValues: () => ({ username: '', password: '' }),\r\n\r\n  // 添加表单校验规则\r\n  validationSchema: Yup.object().shape({\r\n    username: Yup.string()\r\n      .required('账号为必填项')\r\n      .matches(REG_UNAME, '长度为5到8位，只能出现数字、字母、下划线'),\r\n    password: Yup.string()\r\n      .required('密码为必填项')\r\n      .matches(REG_PWD, '长度为5到12位，只能出现数字、字母、下划线')\r\n  }),\r\n\r\n  // 表单的提交事件\r\n  handleSubmit: async (values, { props }) => {\r\n    // 获取账号和密码\r\n    const { username, password } = values\r\n\r\n    // console.log('表单提交了', username, password)\r\n    // 发送请求\r\n    const res = await API.post('/user/login', {\r\n      username,\r\n      password\r\n    })\r\n\r\n    const { status, body, description } = res.data\r\n\r\n    if (status === 200) {\r\n      // 登录成功\r\n      localStorage.setItem('hkzf_token', body.token)\r\n\r\n      /* \r\n        1 登录成功后，判断是否需要跳转到用户想要访问的页面（判断 props.location.state 是否有值）。\r\n        2 如果不需要（没有值），则直接调用 history.go(-1) 返回上一页。\r\n        3 如果需要，就跳转到 from.pathname 指定的页面（推荐使用 replace 方法模式，而不是 push）。\r\n      */\r\n      if (!props.location.state) {\r\n        // 此时，表示是直接进入到了该页面，直接调用 go(-1) 即可\r\n        props.history.go(-1)\r\n      } else {\r\n        // push：[home, login, map]\r\n        // replace: [home, map]\r\n        props.history.replace(props.location.state.from.pathname)\r\n      }\r\n      // 注意：无法在该方法中，通过 this 来获取到路由信息\r\n      // 所以，需要通过 第二个对象参数中获取到 props 来使用 props\r\n      // props.history.go(-1)\r\n    } else {\r\n      // 登录失败\r\n      Toast.info(description, 2, null, false)\r\n    }\r\n  }\r\n})(Login)\r\n\r\n// 注意：此处返回的是 高阶组件 包装后的组件\r\nexport default Login\r\n"],"sourceRoot":""}