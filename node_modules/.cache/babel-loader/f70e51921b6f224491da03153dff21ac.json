{"ast":null,"code":"import \"antd-mobile/lib/flex/style/css\";\nimport _Flex from \"antd-mobile/lib/flex\";\nimport \"antd-mobile/lib/textarea-item/style/css\";\nimport _TextareaItem from \"antd-mobile/lib/textarea-item\";\nimport \"antd-mobile/lib/image-picker/style/css\";\nimport _ImagePicker from \"antd-mobile/lib/image-picker\";\nimport \"antd-mobile/lib/picker/style/css\";\nimport _Picker from \"antd-mobile/lib/picker\";\nimport \"antd-mobile/lib/input-item/style/css\";\nimport _InputItem from \"antd-mobile/lib/input-item\";\nimport \"antd-mobile/lib/list/style/css\";\nimport _List from \"antd-mobile/lib/list\";\nimport \"antd-mobile/lib/toast/style/css\";\nimport _Toast from \"antd-mobile/lib/toast\";\nimport \"antd-mobile/lib/modal/style/css\";\nimport _Modal from \"antd-mobile/lib/modal\";\nvar _jsxFileName = \"E:\\\\react-project\\\\hkzf-mobile\\\\src\\\\pages\\\\Rent\\\\Add\\\\index.js\";\nimport React, { Component } from 'react';\nimport { API } from '../../../utils';\nimport NavHeader from '../../../components/NavHeader';\nimport HousePackge from '../../../components/HousePackage';\nimport styles from './index.module.css';\nconst alert = _Modal.alert; // 房屋类型\n\nconst roomTypeData = [{\n  label: '一室',\n  value: 'ROOM|d4a692e4-a177-37fd'\n}, {\n  label: '二室',\n  value: 'ROOM|d1a00384-5801-d5cd'\n}, {\n  label: '三室',\n  value: 'ROOM|20903ae0-c7bc-f2e2'\n}, {\n  label: '四室',\n  value: 'ROOM|ce2a5daa-811d-2f49'\n}, {\n  label: '四室+',\n  value: 'ROOM|2731c38c-5b19-ff7f'\n}]; // 朝向：\n\nconst orientedData = [{\n  label: '东',\n  value: 'ORIEN|141b98bf-1ad0-11e3'\n}, {\n  label: '西',\n  value: 'ORIEN|103fb3aa-e8b4-de0e'\n}, {\n  label: '南',\n  value: 'ORIEN|61e99445-e95e-7f37'\n}, {\n  label: '北',\n  value: 'ORIEN|caa6f80b-b764-c2df'\n}, {\n  label: '东南',\n  value: 'ORIEN|dfb1b36b-e0d1-0977'\n}, {\n  label: '东北',\n  value: 'ORIEN|67ac2205-7e0f-c057'\n}, {\n  label: '西南',\n  value: 'ORIEN|2354e89e-3918-9cef'\n}, {\n  label: '西北',\n  value: 'ORIEN|80795f1a-e32f-feb9'\n}]; // 楼层\n\nconst floorData = [{\n  label: '高楼层',\n  value: 'FLOOR|1'\n}, {\n  label: '中楼层',\n  value: 'FLOOR|2'\n}, {\n  label: '低楼层',\n  value: 'FLOOR|3'\n}];\nexport default class RentAdd extends Component {\n  constructor(props) {\n    super(props); // console.log(props)\n\n    this.onCancel = () => {\n      alert('提示', '放弃发布房源?', [{\n        text: '放弃',\n        onPress: async () => this.props.history.go(-1)\n      }, {\n        text: '继续编辑'\n      }]);\n    };\n\n    this.getValue = (name, value) => {\n      this.setState({\n        [name]: value\n      });\n    };\n\n    this.handleSupporting = selected => {\n      // console.log(selected)\n      this.setState({\n        supporting: selected.join('|')\n      });\n    };\n\n    this.handleHouseImg = (files, type, index) => {\n      console.log(files, type, index);\n      this.setState({\n        tempSlides: files\n      });\n    };\n\n    this.addHouse = async () => {\n      const _this$state = this.state,\n            tempSlides = _this$state.tempSlides,\n            title = _this$state.title,\n            description = _this$state.description,\n            oriented = _this$state.oriented,\n            supporting = _this$state.supporting,\n            price = _this$state.price,\n            roomType = _this$state.roomType,\n            size = _this$state.size,\n            floor = _this$state.floor,\n            community = _this$state.community;\n      let houseImg = ''; // 上传房屋图片：\n\n      if (tempSlides.length > 0) {\n        // 已经有上传的图片了\n        const form = new FormData();\n        tempSlides.forEach(item => form.append('file', item.file));\n        const res = await API.post('/houses/image', form, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        }); // console.log(res)\n\n        houseImg = res.data.body.join('|');\n      } // 发布房源\n\n\n      const res = await API.post('/user/houses', {\n        title,\n        description,\n        oriented,\n        supporting,\n        price,\n        roomType,\n        size,\n        floor,\n        community: community.id,\n        houseImg\n      });\n\n      if (res.data.status === 200) {\n        // 发布成功\n        _Toast.info('发布成功', 1, null, false);\n\n        this.props.history.push('/rent');\n      } else {\n        _Toast.info('服务器偷懒了，请稍后再试~', 2, null, false);\n      }\n    };\n\n    const state = props.location.state;\n    const _community = {\n      name: '',\n      id: ''\n    };\n\n    if (state) {\n      // 有小区信息数据，存储到状态中\n      _community.name = state.name;\n      _community.id = state.id;\n    }\n\n    this.state = {\n      // 临时图片地址\n      tempSlides: [],\n      // 小区的名称和id\n      community: _community,\n      // 价格\n      price: '',\n      // 面积\n      size: '',\n      // 房屋类型\n      roomType: '',\n      // 楼层\n      floor: '',\n      // 朝向：\n      oriented: '',\n      // 房屋标题\n      title: '',\n      // 房屋图片\n      houseImg: '',\n      // 房屋配套：\n      supporting: '',\n      // 房屋描述\n      description: ''\n    };\n  } // 取消编辑，返回上一页\n\n\n  render() {\n    const Item = _List.Item;\n    const history = this.props.history;\n    const _this$state2 = this.state,\n          community = _this$state2.community,\n          price = _this$state2.price,\n          roomType = _this$state2.roomType,\n          floor = _this$state2.floor,\n          oriented = _this$state2.oriented,\n          description = _this$state2.description,\n          tempSlides = _this$state2.tempSlides,\n          title = _this$state2.title,\n          size = _this$state2.size;\n    return React.createElement(\"div\", {\n      className: styles.root,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219\n      },\n      __self: this\n    }, React.createElement(NavHeader, {\n      onLeftClick: this.onCancel,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220\n      },\n      __self: this\n    }, \"\\u53D1\\u5E03\\u623F\\u6E90\"), React.createElement(_List, {\n      className: styles.header,\n      renderHeader: () => '房源信息',\n      \"data-role\": \"rent-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223\n      },\n      __self: this\n    }, React.createElement(Item, {\n      extra: community.name || '请输入小区名称',\n      arrow: \"horizontal\",\n      onClick: () => history.replace('/rent/search'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, \"\\u5C0F\\u533A\\u540D\\u79F0\"), React.createElement(_InputItem, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u79DF\\u91D1/\\u6708\",\n      extra: \"\\uFFE5/\\u6708\",\n      value: price,\n      onChange: val => this.getValue('price', val),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    }, \"\\u79DF\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\u91D1\"), React.createElement(_InputItem, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u5EFA\\u7B51\\u9762\\u79EF\",\n      extra: \"\\u33A1\",\n      value: size,\n      onChange: val => this.getValue('size', val),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }, \"\\u5EFA\\u7B51\\u9762\\u79EF\"), React.createElement(_Picker, {\n      data: roomTypeData,\n      value: [roomType],\n      cols: 1,\n      onChange: val => this.getValue('roomType', val[0]),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253\n      },\n      __self: this\n    }, React.createElement(Item, {\n      arrow: \"horizontal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259\n      },\n      __self: this\n    }, \"\\u6237\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\u578B\")), React.createElement(_Picker, {\n      data: floorData,\n      value: [floor],\n      cols: 1,\n      onChange: val => this.getValue('floor', val[0]),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264\n      },\n      __self: this\n    }, React.createElement(Item, {\n      arrow: \"horizontal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270\n      },\n      __self: this\n    }, \"\\u6240\\u5728\\u697C\\u5C42\")), React.createElement(_Picker, {\n      data: orientedData,\n      value: [oriented],\n      cols: 1,\n      onChange: val => this.getValue('oriented', val[0]),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272\n      },\n      __self: this\n    }, React.createElement(Item, {\n      arrow: \"horizontal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278\n      },\n      __self: this\n    }, \"\\u671D\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\xA0\\u5411\"))), React.createElement(_List, {\n      className: styles.title,\n      renderHeader: () => '房屋标题',\n      \"data-role\": \"rent-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285\n      },\n      __self: this\n    }, React.createElement(_InputItem, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u6807\\u9898\\uFF08\\u4F8B\\u5982\\uFF1A\\u6574\\u79DF \\u5C0F\\u533A\\u540D 2\\u5BA4 5000\\u5143\\uFF09\",\n      value: title,\n      onChange: val => this.getValue('title', val),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 290\n      },\n      __self: this\n    })), React.createElement(_List, {\n      className: styles.pics,\n      renderHeader: () => '房屋图像',\n      \"data-role\": \"rent-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 298\n      },\n      __self: this\n    }, React.createElement(_ImagePicker, {\n      files: tempSlides,\n      onChange: this.handleHouseImg,\n      multiple: true,\n      className: styles.imgpicker,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 303\n      },\n      __self: this\n    })), React.createElement(_List, {\n      className: styles.supporting,\n      renderHeader: () => '房屋配置',\n      \"data-role\": \"rent-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 312\n      },\n      __self: this\n    }, React.createElement(HousePackge, {\n      select: true,\n      onSelect: this.handleSupporting,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 317\n      },\n      __self: this\n    })), React.createElement(_List, {\n      className: styles.desc,\n      renderHeader: () => '房屋描述',\n      \"data-role\": \"rent-list\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 321\n      },\n      __self: this\n    }, React.createElement(_TextareaItem, {\n      rows: 5,\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u623F\\u5C4B\\u63CF\\u8FF0\\u4FE1\\u606F\",\n      value: description,\n      onChange: val => this.getValue('description', val),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 326\n      },\n      __self: this\n    })), React.createElement(_Flex, {\n      className: styles.bottom,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 334\n      },\n      __self: this\n    }, React.createElement(_Flex.Item, {\n      className: styles.cancel,\n      onClick: this.onCancel,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335\n      },\n      __self: this\n    }, \"\\u53D6\\u6D88\"), React.createElement(_Flex.Item, {\n      className: styles.confirm,\n      onClick: this.addHouse,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 338\n      },\n      __self: this\n    }, \"\\u63D0\\u4EA4\")));\n  }\n\n}","map":{"version":3,"sources":["E:\\react-project\\hkzf-mobile\\src\\pages\\Rent\\Add\\index.js"],"names":["React","Component","API","NavHeader","HousePackge","styles","alert","roomTypeData","label","value","orientedData","floorData","RentAdd","constructor","props","onCancel","text","onPress","history","go","getValue","name","setState","handleSupporting","selected","supporting","join","handleHouseImg","files","type","index","console","log","tempSlides","addHouse","state","title","description","oriented","price","roomType","size","floor","community","houseImg","length","form","FormData","forEach","item","append","file","res","post","headers","data","body","id","status","info","push","location","render","Item","root","header","replace","val","pics","imgpicker","desc","bottom","cancel","confirm"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\n\r\nimport {\r\n  Flex,\r\n  List,\r\n  InputItem,\r\n  Picker,\r\n  ImagePicker,\r\n  TextareaItem,\r\n  Modal,\r\n  Toast\r\n} from 'antd-mobile'\r\n\r\nimport { API } from '../../../utils'\r\n\r\nimport NavHeader from '../../../components/NavHeader'\r\nimport HousePackge from '../../../components/HousePackage'\r\n\r\nimport styles from './index.module.css'\r\n\r\nconst alert = Modal.alert\r\n\r\n// 房屋类型\r\nconst roomTypeData = [\r\n  { label: '一室', value: 'ROOM|d4a692e4-a177-37fd' },\r\n  { label: '二室', value: 'ROOM|d1a00384-5801-d5cd' },\r\n  { label: '三室', value: 'ROOM|20903ae0-c7bc-f2e2' },\r\n  { label: '四室', value: 'ROOM|ce2a5daa-811d-2f49' },\r\n  { label: '四室+', value: 'ROOM|2731c38c-5b19-ff7f' }\r\n]\r\n\r\n// 朝向：\r\nconst orientedData = [\r\n  { label: '东', value: 'ORIEN|141b98bf-1ad0-11e3' },\r\n  { label: '西', value: 'ORIEN|103fb3aa-e8b4-de0e' },\r\n  { label: '南', value: 'ORIEN|61e99445-e95e-7f37' },\r\n  { label: '北', value: 'ORIEN|caa6f80b-b764-c2df' },\r\n  { label: '东南', value: 'ORIEN|dfb1b36b-e0d1-0977' },\r\n  { label: '东北', value: 'ORIEN|67ac2205-7e0f-c057' },\r\n  { label: '西南', value: 'ORIEN|2354e89e-3918-9cef' },\r\n  { label: '西北', value: 'ORIEN|80795f1a-e32f-feb9' }\r\n]\r\n\r\n// 楼层\r\nconst floorData = [\r\n  { label: '高楼层', value: 'FLOOR|1' },\r\n  { label: '中楼层', value: 'FLOOR|2' },\r\n  { label: '低楼层', value: 'FLOOR|3' }\r\n]\r\n\r\nexport default class RentAdd extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    // console.log(props)\r\n    const { state } = props.location\r\n    const community = {\r\n      name: '',\r\n      id: ''\r\n    }\r\n\r\n    if (state) {\r\n      // 有小区信息数据，存储到状态中\r\n      community.name = state.name\r\n      community.id = state.id\r\n    }\r\n\r\n    this.state = {\r\n      // 临时图片地址\r\n      tempSlides: [],\r\n\r\n      // 小区的名称和id\r\n      community,\r\n      // 价格\r\n      price: '',\r\n      // 面积\r\n      size: '',\r\n      // 房屋类型\r\n      roomType: '',\r\n      // 楼层\r\n      floor: '',\r\n      // 朝向：\r\n      oriented: '',\r\n      // 房屋标题\r\n      title: '',\r\n      // 房屋图片\r\n      houseImg: '',\r\n      // 房屋配套：\r\n      supporting: '',\r\n      // 房屋描述\r\n      description: ''\r\n    }\r\n  }\r\n\r\n  // 取消编辑，返回上一页\r\n  onCancel = () => {\r\n    alert('提示', '放弃发布房源?', [\r\n      {\r\n        text: '放弃',\r\n        onPress: async () => this.props.history.go(-1)\r\n      },\r\n      {\r\n        text: '继续编辑'\r\n      }\r\n    ])\r\n  }\r\n\r\n  /* \r\n    获取表单数据：\r\n  */\r\n  getValue = (name, value) => {\r\n    this.setState({\r\n      [name]: value\r\n    })\r\n  }\r\n\r\n  /* \r\n    获取房屋配置数据：\r\n  */\r\n  handleSupporting = selected => {\r\n    // console.log(selected)\r\n    this.setState({\r\n      supporting: selected.join('|')\r\n    })\r\n  }\r\n\r\n  /* \r\n    获取房屋图片：\r\n\r\n    1 给 ImagePicker 组件添加 onChange 配置项。\r\n    2 通过 onChange 的参数，获取到上传的图片，并存储到状态 tempSlides 中。\r\n  */\r\n  handleHouseImg = (files, type, index) => {\r\n    console.log(files, type, index)\r\n    this.setState({\r\n      tempSlides: files\r\n    })\r\n  }\r\n\r\n  /* \r\n    发布房源：\r\n\r\n    1 在 addHouse 方法中，从 state 里面获取到所有房屋数据。\r\n    2 使用 API 调用发布房源接口，传递所有房屋数据。\r\n    3 根据接口返回值中的状态码，判断是否发布成功。\r\n    4 如果状态码是 200，表示发布成功，就提示：发布成功，并跳转到已发布房源页面。\r\n    5 否则，就提示：服务器偷懒了，请稍后再试~。\r\n  */\r\n  addHouse = async () => {\r\n    const {\r\n      tempSlides,\r\n      title,\r\n      description,\r\n      oriented,\r\n      supporting,\r\n      price,\r\n      roomType,\r\n      size,\r\n      floor,\r\n      community\r\n    } = this.state\r\n    let houseImg = ''\r\n\r\n    // 上传房屋图片：\r\n    if (tempSlides.length > 0) {\r\n      // 已经有上传的图片了\r\n      const form = new FormData()\r\n      tempSlides.forEach(item => form.append('file', item.file))\r\n\r\n      const res = await API.post('/houses/image', form, {\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data'\r\n        }\r\n      })\r\n\r\n      // console.log(res)\r\n      houseImg = res.data.body.join('|')\r\n    }\r\n\r\n    // 发布房源\r\n    const res = await API.post('/user/houses', {\r\n      title,\r\n      description,\r\n      oriented,\r\n      supporting,\r\n      price,\r\n      roomType,\r\n      size,\r\n      floor,\r\n      community: community.id,\r\n      houseImg\r\n    })\r\n\r\n    if (res.data.status === 200) {\r\n      // 发布成功\r\n      Toast.info('发布成功', 1, null, false)\r\n      this.props.history.push('/rent')\r\n    } else {\r\n      Toast.info('服务器偷懒了，请稍后再试~', 2, null, false)\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const Item = List.Item\r\n    const { history } = this.props\r\n    const {\r\n      community,\r\n      price,\r\n      roomType,\r\n      floor,\r\n      oriented,\r\n      description,\r\n      tempSlides,\r\n      title,\r\n      size\r\n    } = this.state\r\n\r\n    return (\r\n      <div className={styles.root}>\r\n        <NavHeader onLeftClick={this.onCancel}>发布房源</NavHeader>\r\n\r\n        {/* 房源信息 */}\r\n        <List\r\n          className={styles.header}\r\n          renderHeader={() => '房源信息'}\r\n          data-role=\"rent-list\"\r\n        >\r\n          {/* 选择所在小区 */}\r\n          <Item\r\n            extra={community.name || '请输入小区名称'}\r\n            arrow=\"horizontal\"\r\n            onClick={() => history.replace('/rent/search')}\r\n          >\r\n            小区名称\r\n          </Item>\r\n          {/* 相当于 form 表单的 input 元素 */}\r\n          <InputItem\r\n            placeholder=\"请输入租金/月\"\r\n            extra=\"￥/月\"\r\n            value={price}\r\n            onChange={val => this.getValue('price', val)}\r\n          >\r\n            租&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;金\r\n          </InputItem>\r\n          <InputItem\r\n            placeholder=\"请输入建筑面积\"\r\n            extra=\"㎡\"\r\n            value={size}\r\n            onChange={val => this.getValue('size', val)}\r\n          >\r\n            建筑面积\r\n          </InputItem>\r\n          <Picker\r\n            data={roomTypeData}\r\n            value={[roomType]}\r\n            cols={1}\r\n            onChange={val => this.getValue('roomType', val[0])}\r\n          >\r\n            <Item arrow=\"horizontal\">\r\n              户&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;型\r\n            </Item>\r\n          </Picker>\r\n\r\n          <Picker\r\n            data={floorData}\r\n            value={[floor]}\r\n            cols={1}\r\n            onChange={val => this.getValue('floor', val[0])}\r\n          >\r\n            <Item arrow=\"horizontal\">所在楼层</Item>\r\n          </Picker>\r\n          <Picker\r\n            data={orientedData}\r\n            value={[oriented]}\r\n            cols={1}\r\n            onChange={val => this.getValue('oriented', val[0])}\r\n          >\r\n            <Item arrow=\"horizontal\">\r\n              朝&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;向\r\n            </Item>\r\n          </Picker>\r\n        </List>\r\n\r\n        {/* 房屋标题 */}\r\n        <List\r\n          className={styles.title}\r\n          renderHeader={() => '房屋标题'}\r\n          data-role=\"rent-list\"\r\n        >\r\n          <InputItem\r\n            placeholder=\"请输入标题（例如：整租 小区名 2室 5000元）\"\r\n            value={title}\r\n            onChange={val => this.getValue('title', val)}\r\n          />\r\n        </List>\r\n\r\n        {/* 房屋图像 */}\r\n        <List\r\n          className={styles.pics}\r\n          renderHeader={() => '房屋图像'}\r\n          data-role=\"rent-list\"\r\n        >\r\n          <ImagePicker\r\n            files={tempSlides}\r\n            onChange={this.handleHouseImg}\r\n            multiple={true}\r\n            className={styles.imgpicker}\r\n          />\r\n        </List>\r\n\r\n        {/* 房屋配置 */}\r\n        <List\r\n          className={styles.supporting}\r\n          renderHeader={() => '房屋配置'}\r\n          data-role=\"rent-list\"\r\n        >\r\n          <HousePackge select onSelect={this.handleSupporting} />\r\n        </List>\r\n\r\n        {/* 房屋描述 */}\r\n        <List\r\n          className={styles.desc}\r\n          renderHeader={() => '房屋描述'}\r\n          data-role=\"rent-list\"\r\n        >\r\n          <TextareaItem\r\n            rows={5}\r\n            placeholder=\"请输入房屋描述信息\"\r\n            value={description}\r\n            onChange={val => this.getValue('description', val)}\r\n          />\r\n        </List>\r\n\r\n        <Flex className={styles.bottom}>\r\n          <Flex.Item className={styles.cancel} onClick={this.onCancel}>\r\n            取消\r\n          </Flex.Item>\r\n          <Flex.Item className={styles.confirm} onClick={this.addHouse}>\r\n            提交\r\n          </Flex.Item>\r\n        </Flex>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}